<!DOCTYPE html>
<html>

<head>
    <title>시작화면2</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="Recordstyle.css">
</head>

<body>
    <div id="Verticalgrid">
        <div class="container" id="ul">
            <input type="text" value="제목" class="list" id="IndexTitle">
            <div class="SmallTitleGrid">
                <input type="text" value="소제목0" class="list">
                <script>
                    var count = 0;
                    function addinput(elem) { //input 요소를 리스트 안에 넣어놓는 함수.
                        if (document.getElementById('UserInput'+elem.id) == null) {// 한 소제목에서 UserInput이 없을 때만 가능
                            var input = document.createElement("input"); //문서에 태그 추가 함수
                            input.setAttribute('type', 'text'); //속성 추가 함수
                            input.setAttribute('id', 'UserInput'+elem.id);
                            input.setAttribute('onkeyup', 'onkeypress2('+elem.id+')');
                            document.getElementById('ul2_'+elem.id).append(input);
                        }
                    }
                    function onkeypress2(ID) { //엔터키가 입력될 경우, 그대로 확정하는 함수
                        console.log();
                        //둘 이상의 Userinput이 나올 경우, UserInput이 getElementsByClassName의 인덱스가 변동되어 오류 발생. 그래서 ID로 변동
                        var input = document.getElementById('UserInput'+ID); //맞는 클래스를 가진 첫 번째 요소를 찾는 함수
                        console.log(input);
                        if (window.event.keyCode == 13 ) {
                            addList(input.value, ID);
                            input.remove(); // 다 쓴 UserInput를 삭제한다.
                        }


                    }
                    function addList(InputValue, ID) { //ul2 태그의 리스트 요소를 추가시키는 것.
                        // console.log('작동됨');


                        var li = document.createElement("li");
                        li.setAttribute("onclick", "ClickList()"); //클릭 시에 글을 쓰는 공간을 만들어냄
                        li.setAttribute("oncontextmenu","DBLclick("+ID+','+InputValue+")"); //더블클릭 시에 소제목의 인덱스와 내부의 저장값을 전달.
                        li.append(document.createTextNode(InputValue)); //append = 해당하는 태그의 바로 다음에 추가되는 태그 
                        document.getElementById('ul2_'+ID).appendChild(li);
                    }
                    
                    function DBLclick(ID,Value) { //더블 클릭시에 수정 가능하도록 하는 함수. 더 정확히 다시 UserInput을 불러내고, 수정가능하게 하는 것
                        console.log('작동됨');
                        event.preventDefault();//기본 오른쪽 클릭 막음.
                        if (document.getElementById('UserInput'+ID) == null) {//한 소제목에서 UserInput이 없을 때만 가능
                            var input = document.createElement("input"); //문서에 태그 추가 함수
                            input.setAttribute('type', 'text'); //속성 추가 함수
                            input.setAttribute('id', 'UserInput'+ID);
                            input.setAttribute('value',Value); //이전의 쓴 값을 다시 불러오는 함수.
                            input.setAttribute('onkeyup', 'onkeypress2('+ID+')'); //엔터 키가 눌리면 리스트가 확정되게 하는 함수
                            document.getElementById('ul2_'+ID).append(input); //지정된 소제목의 리스트에 추가하는 함수.
                        }
                    }
                </script>
                <input type="button" class="Button AddButton" id ="0" onclick="addinput(this)"> 
                <script>
                    function Hide_Apperance(elem) { //리스트를 숨기거나 나타내는 함수

                        console.log(elem.id);
                        var List = document.getElementById('ul2_'+elem.id);
                        //console.log(List.style.display);
                        if (List.style.display === "block" || List.style.display === "") { // ===같은 연산자 !== 다름 연산자
                            List.style.display = "none";
                            elem.style.transform = "rotate(90deg)";
                            elem.style.marginLeft = "0px";
                        }
                        else {

                            List.style.display = "block";
                            elem.style.transform = "rotate(0deg)";
                            elem.style.marginLeft = "5px";
                        }


                    }
                </script>
                <input type="button" class="Button VButton" id = "0"onclick="Hide_Apperance(this)">

            </div>
            <ul id="ul2_0" style="display:block">
                <li onclick="alert('오류!')">abc</li>
            </ul>
            <script>
                function CloneSmallTitle() {
                    console.log('작동됨');
                    console.log(count);
                    
                    var SmallTitlegrid = document.getElementsByClassName('SmallTitleGrid')[0];
                    var Cloning = SmallTitlegrid.cloneNode(true); // 하위 노드까지 복제.
                    var List = document.getElementById('ul2_'+count);
                    var ListClone = List.cloneNode(false);
                    var Length = document.getElementsByClassName('Button VButton').length;

                    List.after(Cloning);
                    Cloning.after(ListClone);
                    var SmallTitle = document.getElementsByClassName('list')[Length+1]; //삭제 구현이 오류 가능성 있음.
                    var HAButton = document.getElementsByClassName('Button VButton')[Length];
                    var AddButton = document.getElementsByClassName('Button AddButton')[Length];
                    SmallTitle.setAttribute('value','소제목'+(count+1));
                    count++;
                    ListClone.removeAttribute('id');
                    ListClone.setAttribute('id','ul2_'+count);
                    HAButton.removeAttribute('id');
                    HAButton.setAttribute('id',count);
                    AddButton.removeAttribute('id');
                    AddButton.setAttribute('id',count);

                }
            </script>
            <input type="button" value="새 소제목 추가" class="SmallTitleAdd" onclick = "CloneSmallTitle()">
            <script>
                function ClickList() {
                    var VG = document.getElementById('Verticalgrid');
                    var TextBox = document.getElementsByClassName('Middle')[0];
                    // console.log(VG === null);
                    // console.log(TextBox === null);
                    // console.log(document.getElementById('MenuText') === null)
                    if (document.getElementById('MenuText') === null) {
                        //newBlock.setAttribute('class', container);
                        VG.style.gridTemplateColumns = "250px 1fr 1fr";
                        TextBox.setAttribute('id', 'MenuText');

                    }
                    else {
                        //console.log('작동됨');
                        TextBox.removeAttribute('id', 'MenuText');
                        VG.style.gridTemplateColumns = "250px 20px 1fr";

                    }
                }
            </script>
        </div>
        <div class="Middle"></div>
        <div class="Hgrid">
            <div id="map"></div>
            <script type="text/javascript"
                src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0c3a0d263542cb055a084b7446133650"></script>
            <script>
                var container = document.getElementById('map');
                var options = {
                    center: new kakao.maps.LatLng(33.450701, 126.570667),
                    level: 3
                };

                var map = new kakao.maps.Map(container, options);
            </script>
            <div class="container" id="Padding"></div>
        </div>
    </div>
</body>

</html>